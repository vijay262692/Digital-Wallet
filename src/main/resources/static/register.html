<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register | Digital Wallet</title>
  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #007bff, #00c6ff);
           display: flex; justify-content: center; align-items: center; height: 100vh; color: #fff; }
    .box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 16px; width: 360px;
           backdrop-filter: blur(10px); box-shadow: 0 0 20px rgba(0,0,0,0.3); text-align: center; }
    input, button { width: 100%; padding: 10px; border: none; border-radius: 8px; margin: 8px 0; font-size: 14px; }
    input { background: rgba(255,255,255,0.9); color: #333; }
    button { background: linear-gradient(90deg,#00b4db,#0072ff); color: #fff; cursor: pointer; font-weight: bold; }
    button:hover { transform: translateY(-2px); }
  </style>
</head>
<body>
  <div class="box">
    <h2>üßç Register</h2>
    <input id="username" placeholder="Username" required />
    <input id="password" type="password" placeholder="Password" required />
    <button onclick="register()">Register</button>
    <div id="result"></div>
    <p>Already registered? <a href="login.html" style="color:#fff;">Login</a></p>
  </div> 

  <script>
    async function register() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      console.log("User registration initiated:", username);

      const res = await fetch("/api/users/publicKey");
      const keyB64 = await res.text();
      const der = forge.util.decode64(keyB64);
      const asn1 = forge.asn1.fromDer(der);
      const pubKey = forge.pki.publicKeyFromAsn1(asn1);
      const encrypted = forge.util.encode64(pubKey.encrypt(`${username}|${password}`, "RSAES-PKCS1-V1_5"));

      const response = await fetch("/api/users/register", {
        method: "POST", headers: { "Content-Type": "text/plain" }, body: encrypted
      });

      const result = await response.json();
      document.getElementById("result").innerHTML = `<p>${result.message}</p>`;
    }
  </script>
</body>
</html>
