<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login | Digital Wallet</title>
  <script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg,#00b4db,#0072ff);
           display: flex; justify-content: center; align-items: center; height: 100vh; color: #fff; }
    .box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 16px; width: 360px;
           backdrop-filter: blur(10px); box-shadow: 0 0 20px rgba(0,0,0,0.3); text-align: center; }
    input, button { width: 100%; padding: 10px; border: none; border-radius: 8px; margin: 8px 0; font-size: 14px; }
    input { background: rgba(255,255,255,0.9); color: #333; }
    button { background: linear-gradient(90deg,#00c6ff,#0072ff); color: #fff; cursor: pointer; font-weight: bold; }
    button:hover { transform: translateY(-2px); }
  </style>
</head>
<body>
  <div class="box">
    <h2>üîê Login</h2>
    <input id="username" placeholder="Username" required />
    <input id="password" type="password" placeholder="Password" required />
    <button onclick="login()">Login</button>
    <div id="result"></div>
    <p>New user? <a href="register.html" style="color:#fff;">Register</a></p>
  </div>

  <script>
    async function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
<<<<<<< HEAD
      console.log("Sending login request to server...");
      const res = await fetch("/api/users/publicKey");
=======
      const res = await fetch("/api/user/publicKey");
>>>>>>> 8c5f1d0 (Login support for username or email + register form fix)
      const keyB64 = await res.text();
      const der = forge.util.decode64(keyB64);
      const asn1 = forge.asn1.fromDer(der);
      const pubKey = forge.pki.publicKeyFromAsn1(asn1);
const encrypted = forge.util.encode64(pubKey.encrypt(`${username}|${password}`, "RSAES-PKCS1-V1_5"));

      const response = await fetch("/api/user/login", {
        method: "POST", headers: { "Content-Type": "text/plain" }, body: encrypted
      });

      const result = await response.json();
      if (result.status === "SUCCESS") {
        localStorage.setItem("loggedInUser", username);
        window.location.href = "view-cards.html";
      } else {
        document.getElementById("result").innerHTML = `<p>${result.message}</p>`;
      }
    }
  </script>
</body>
</html>
