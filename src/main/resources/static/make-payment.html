<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make Payment | Digital Wallet</title>
  <style>
    body { font-family:'Poppins'; background:linear-gradient(135deg,#0072ff,#00b4db);
           display:flex; flex-direction:column; align-items:center; padding:40px; color:white; }
    select, input, button { width:300px; padding:10px; margin:8px; border-radius:8px; border:none; font-size:15px; }
    button { background:#00c6ff; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <h2>ðŸ’¸ Make a Payment</h2>
  <select id="tokenSelect"></select>
  <input id="amount" placeholder="Enter Amount â‚¹" />
  <input id="merchant" placeholder="Merchant Name" />
  <button onclick="pay()">Pay</button>
  <div id="result"></div>

  <script>
    async function loadCards() {
      const username = localStorage.getItem("loggedInUser");
      const res = await fetch(`/api/wallet/cards/${username}`);
      const cards = await res.json();
      const select = document.getElementById("tokenSelect");
      cards.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.token;
        opt.textContent = `${c.provider} - ${c.maskedPan}`;
        select.appendChild(opt);
      });
    }

    async function pay() {
      const token = document.getElementById("tokenSelect").value;
      const amount = document.getElementById("amount").value;
      const merchant = document.getElementById("merchant").value;
      console.log("Payment initiated for:", merchant, "Amount:", amount); 
      const res = await fetch("/api/wallet/pay", {
        method:"POST", headers:{"Content-Type":"application/json"},
        body:JSON.stringify({ token, amount, merchant })
      });
      const result = await res.json();
      document.getElementById("result").innerHTML = `<p>${result.message}</p>`;
    }

    loadCards();
  </script>
</body>
</html>
